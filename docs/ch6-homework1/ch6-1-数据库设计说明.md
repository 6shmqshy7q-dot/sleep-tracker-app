# CH6-1 数据库设计说明

## 一、项目概述

### 项目信息
- **项目名称**: personal-site-db
- **数据库类型**: PostgreSQL
- **PostgreSQL版本**: 17
- **部署区域**: 新加坡（Singapore）
- **用途**: 个人网站留言功能数据存储

### 设计目标
为个人网站构建一个简洁高效的留言系统，支持用户留言、邮箱回复功能，并确保数据安全和系统稳定性。

## 二、数据库表结构设计

### 表名：messages（用户留言信息表）

| 字段名 | 数据类型 | 约束条件 | 默认值 | 用途说明 |
|--------|----------|----------|--------|----------|
| id | SERIAL | PRIMARY KEY | 自动生成 | 留言唯一标识符，自增主键 |
| name | VARCHAR(255) | NOT NULL | - | 留言人姓名，必填字段 |
| email | VARCHAR(255) | 可选 | NULL | 留言人邮箱地址，用于回复联系 |
| content | TEXT | NOT NULL | - | 留言具体内容，支持长文本 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 留言创建时间，自动记录 |
| is_read | BOOLEAN | - | FALSE | 留言阅读状态，默认未读 |

### 表结构图示

```
messages表
├── id (主键, 自增)
├── name (非空)
├── email (可空)
├── content (非空)
├── created_at (自动时间戳)
└── is_read (布尔值, 默认false)
```

## 三、字段详细说明

### 1. id 字段
- **类型**: SERIAL（自增整数）
- **作用**: 作为表的主键，确保每条留言记录的唯一性
- **特点**: 无需手动插入，数据库自动维护

### 2. name 字段
- **类型**: VARCHAR(255)
- **约束**: NOT NULL（必填）
- **作用**: 存储留言人的姓名
- **限制**: 最大长度255字符

### 3. email 字段
- **类型**: VARCHAR(255)
- **约束**: 可选（可为NULL）
- **作用**: 存储留言人邮箱，便于网站管理员回复
- **注意**: 虽然可选，但建议留言时填写

### 4. content 字段
- **类型**: TEXT
- **约束**: NOT NULL（必填）
- **作用**: 存储留言的完整内容
- **优势**: TEXT类型支持无限长度，适应各种长度的留言

### 5. created_at 字段
- **类型**: TIMESTAMP
- **约束**: 自动生成
- **默认**: CURRENT_TIMESTAMP
- **作用**: 记录留言创建时间，便于时间排序和统计

### 6. is_read 字段
- **类型**: BOOLEAN
- **默认**: FALSE
- **作用**: 标记留言是否已被管理员查看
- **用途**: 帮助管理员追踪未读留言

## 四、安全配置与最佳实践

### 1. 连接安全
- **环境变量**: 数据库连接字符串存储在 `.env` 文件中
- **版本控制**: `.env` 文件已添加到 `.gitignore`，避免敏感信息泄露
- **密钥管理**: 使用环境变量而非硬编码方式管理数据库凭证

### 2. 数据验证
- **必填字段**: name 和 content 字段设置 NOT NULL 约束
- **长度限制**: 字符串字段设置合理的长度限制
- **邮箱验证**: 建议在应用层添加邮箱格式验证

### 3. 索引优化
建议为以下字段创建索引：
- `id`: 主键索引（自动创建）
- `created_at`: 用于时间范围查询
- `is_read`: 用于未读留言筛选

## 五、使用示例

### 插入留言
```sql
INSERT INTO messages (name, email, content)
VALUES ('张三', 'zhangsan@example.com', '这是一个测试留言');
```

### 查询未读留言
```sql
SELECT * FROM messages
WHERE is_read = FALSE
ORDER BY created_at DESC;
```

### 标记留言为已读
```sql
UPDATE messages
SET is_read = TRUE
WHERE id = 1;
```

## 六、扩展性考虑

### 未来可能的字段扩展
1. **ip_address**: 记录留言人IP地址
2. **user_agent**: 记录浏览器信息
3. **reply_content**: 管理员回复内容
4. **status**: 留言状态（pending, approved, rejected）

### 可能的表扩展
1. **replies表**: 存储管理员回复
2. **categories表**: 留言分类
3. **attachments表**: 留言附件

## 七、总结

本数据库设计遵循以下原则：
- **简洁性**: 表结构简单明了，易于理解和维护
- **实用性**: 字段设计满足实际业务需求
- **安全性**: 通过环境变量管理敏感信息
- **可扩展性**: 为未来功能扩展预留空间

该设计能够满足个人网站留言系统的基本需求，并具备良好的扩展性和维护性。
